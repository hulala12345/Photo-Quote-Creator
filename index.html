<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Quote Creator</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
    <style>
        body { font-family: Roboto, sans-serif; margin: 0; padding: 0; display: flex; height: 100vh; }
        #controls { width: 300px; padding: 10px; background: #f4f4f4; overflow-y: auto; }
        #canvas-container { flex: 1; position: relative; }
        canvas { border: 1px solid #ccc; }
        .template-thumb { width: 100%; cursor: pointer; margin-bottom: 5px; }
        input[type="color"] { width: 100%; }
    </style>
</head>
<body>
<div id="controls">
    <h2>Photo Quote Creator</h2>
    <div>
        <label>Upload Image:</label>
        <input type="file" id="imageLoader" accept="image/png, image/jpeg" />
    </div>
    <div>
        <h3>Templates</h3>
        <div id="templates"></div>
    </div>
    <div>
        <h3>Add Text</h3>
        <input type="text" id="quoteText" placeholder="Enter quote" style="width:100%"/>
        <label>Font</label>
        <select id="fontFamily">
            <option value="Arial">Arial</option>
            <option value="Verdana">Verdana</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Georgia">Georgia</option>
            <option value="Courier New">Courier New</option>
            <option value="Lucida Console">Lucida Console</option>
            <option value="Trebuchet MS">Trebuchet MS</option>
            <option value="Impact">Impact</option>
            <option value="Comic Sans MS">Comic Sans MS</option>
            <option value="Helvetica">Helvetica</option>
        </select>
        <label>Size</label>
        <input type="number" id="fontSize" min="8" max="72" value="32" style="width:100%"/>
        <label>Color</label>
        <input type="color" id="fontColor" value="#000000"/>
        <label>Alignment</label>
        <select id="textAlign">
            <option value="left">Left</option>
            <option value="center" selected>Center</option>
            <option value="right">Right</option>
        </select>
        <button id="addText">Add Text</button>
    </div>
    <div>
        <h3>Shapes</h3>
        <div id="shapes"></div>
    </div>
    <button id="downloadPng">Download PNG</button>
    <button id="downloadJpg">Download JPG</button>
</div>
<div id="canvas-container">
    <canvas id="c" width="800" height="600"></canvas>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.2.4/fabric.min.js"></script>
<script>
    const canvas = new fabric.Canvas('c');
    canvas.setBackgroundColor('#fff', canvas.renderAll.bind(canvas));
    document.getElementById('imageLoader').addEventListener('change', handleImage, false);
    function handleImage(e){
        const reader = new FileReader();
        reader.onload = function(event){
            const imgObj = new Image();
            imgObj.src = event.target.result;
            imgObj.onload = function () {
                if(imgObj.width < 1080 || imgObj.height < 1080){
                    alert('Image must be at least 1080p resolution.');
                    return;
                }
                const img = new fabric.Image(imgObj);
                img.scaleToWidth(canvas.getWidth());
                canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
            }
        }
        reader.readAsDataURL(e.target.files[0]);
    }
    document.getElementById('addText').onclick = () => {
        const text = new fabric.Textbox(document.getElementById('quoteText').value || 'Your Quote', {
            left: canvas.getWidth()/2,
            top: canvas.getHeight()/2,
            fill: document.getElementById('fontColor').value,
            fontSize: parseInt(document.getElementById('fontSize').value, 10),
            fontFamily: document.getElementById('fontFamily').value,
            textAlign: document.getElementById('textAlign').value,
            originX: 'center'
        });
        canvas.add(text).setActiveObject(text);
    };
    const shapes = [
        'rect','circle','triangle','diamond','pentagon','hexagon','octagon','star','star6','star8','heart','arrowLeft','arrowRight','arrowUp','arrowDown','line','plus','minus','check','cross'
    ];
    const shapesContainer = document.getElementById('shapes');
    shapes.forEach(shape => {
        const btn = document.createElement('button');
        btn.textContent = shape;
        btn.onclick = () => addShape(shape);
        shapesContainer.appendChild(btn);
    });
    function polygonPoints(sides, r){
        const pts = [];
        for(let i=0;i<sides;i++){
            const angle = (Math.PI*2*i)/sides;
            pts.push({x:r*Math.cos(angle), y:r*Math.sin(angle)});
        }
        return pts;
    }
    function starPoints(points, outer, inner){
        const pts = [];
        for(let i=0;i<points*2;i++){
            const r = i%2===0?outer:inner;
            const angle = Math.PI/points*i;
            pts.push({x:r*Math.sin(angle), y:-r*Math.cos(angle)});
        }
        return pts;
    }
    function addShape(type){
        let obj;
        const size = 60;
        switch(type){
            case 'rect':
                obj = new fabric.Rect({width:size, height:size, fill:'rgba(0,0,0,0.3)'}); break;
            case 'circle':
                obj = new fabric.Circle({radius:size/2, fill:'rgba(0,0,0,0.3)'}); break;
            case 'triangle':
                obj = new fabric.Triangle({width:size, height:size, fill:'rgba(0,0,0,0.3)'}); break;
            case 'diamond':
                obj = new fabric.Polygon([{x:0,y:-size/2},{x:size/2,y:0},{x:0,y:size/2},{x:-size/2,y:0}],{fill:'rgba(0,0,0,0.3)'}); break;
            case 'pentagon':
                obj = new fabric.Polygon(polygonPoints(5,size/2),{fill:'rgba(0,0,0,0.3)'}); break;
            case 'hexagon':
                obj = new fabric.Polygon(polygonPoints(6,size/2),{fill:'rgba(0,0,0,0.3)'}); break;
            case 'octagon':
                obj = new fabric.Polygon(polygonPoints(8,size/2),{fill:'rgba(0,0,0,0.3)'}); break;
            case 'star':
                obj = new fabric.Polygon(starPoints(5,size/2,size/4),{fill:'rgba(0,0,0,0.3)'}); break;
            case 'star6':
                obj = new fabric.Polygon(starPoints(6,size/2,size/4),{fill:'rgba(0,0,0,0.3)'}); break;
            case 'star8':
                obj = new fabric.Polygon(starPoints(8,size/2,size/4),{fill:'rgba(0,0,0,0.3)'}); break;
            case 'heart':
                obj = new fabric.Path('M0,0 C0,-30 25,-30 25,-15 C25,-30 50,-30 50,0 C50,25 25,40 0,55 C-25,40 -50,25 -50,0 C-50,-30 -25,-30 -25,-15 C-25,-30 0,-30 0,0 z', {fill:'rgba(0,0,0,0.3)', scaleX:0.5, scaleY:0.5}); break;
            case 'arrowLeft':
                obj = new fabric.Polygon([{x:-size/2,y:0},{x:0,y:-size/2},{x:0,y:-size/4},{x:size/2,y:-size/4},{x:size/2,y:size/4},{x:0,y:size/4},{x:0,y:size/2}],{fill:'rgba(0,0,0,0.3)'}); break;
            case 'arrowRight':
                obj = new fabric.Polygon([{x:size/2,y:0},{x:0,y:-size/2},{x:0,y:-size/4},{x:-size/2,y:-size/4},{x:-size/2,y:size/4},{x:0,y:size/4},{x:0,y:size/2}],{fill:'rgba(0,0,0,0.3)'}); break;
            case 'arrowUp':
                obj = new fabric.Polygon([{x:0,y:-size/2},{x:-size/2,y:0},{x:-size/4,y:0},{x:-size/4,y:size/2},{x:size/4,y:size/2},{x:size/4,y:0},{x:size/2,y:0}],{fill:'rgba(0,0,0,0.3)'}); break;
            case 'arrowDown':
                obj = new fabric.Polygon([{x:0,y:size/2},{x:-size/2,0},{x:-size/4,0},{x:-size/4,-size/2},{x:size/4,-size/2},{x:size/4,0},{x:size/2,0}],{fill:'rgba(0,0,0,0.3)'}); break;
            case 'line':
                obj = new fabric.Line([-size/2,0,size/2,0],{stroke:'rgba(0,0,0,0.3)',strokeWidth:10}); break;
            case 'plus':
                obj = new fabric.Group([
                    new fabric.Rect({width:size, height:size/4, fill:'rgba(0,0,0,0.3)', originX:'center', originY:'center'}),
                    new fabric.Rect({width:size/4, height:size, fill:'rgba(0,0,0,0.3)', originX:'center', originY:'center'})
                ]); break;
            case 'minus':
                obj = new fabric.Rect({width:size, height:size/4, fill:'rgba(0,0,0,0.3)'}); break;
            case 'check':
                obj = new fabric.Polyline([{x:-size/2,y:0},{x:-size/8,y:size/2},{x:size/2,-size/2}],{stroke:'rgba(0,0,0,0.3)',strokeWidth:10,fill:''}); break;
            case 'cross':
                obj = new fabric.Group([
                    new fabric.Rect({width:size, height:size/4, fill:'rgba(0,0,0,0.3)', angle:45, originX:'center', originY:'center'}),
                    new fabric.Rect({width:size, height:size/4, fill:'rgba(0,0,0,0.3)', angle:-45, originX:'center', originY:'center'})
                ]); break;
            default:
                obj = new fabric.Text(type,{fontSize:20});
        }
        obj.originX = 'center';
        obj.originY = 'center';
        obj.left = canvas.getWidth()/2;
        obj.top = canvas.getHeight()/2;
        canvas.add(obj).setActiveObject(obj);
    }
    function applyTemplate(index){
        canvas.clear();
        canvas.setBackgroundColor('#fff', canvas.renderAll.bind(canvas));
        const layouts = [
            function(){
                const text = new fabric.Textbox('Quote', {left:400, top:100, fontSize:40, originX:'center'});
                canvas.add(text);
            },
            function(){
                const text = new fabric.Textbox('Quote', {left:400, top:300, fontSize:40, originX:'center'});
                canvas.add(text);
            },
            function(){
                const text = new fabric.Textbox('Quote', {left:100, top:500, fontSize:40});
                canvas.add(text);
            },
            function(){
                const text = new fabric.Textbox('Quote', {left:700, top:500, fontSize:40, textAlign:'right'});
                canvas.add(text);
            },
            function(){
                const rect = new fabric.Rect({left:400,top:300,width:600,height:200,fill:'rgba(255,255,255,0.5)',originX:'center'});
                const text = new fabric.Textbox('Quote', {left:400, top:300, fontSize:40, originX:'center'});
                canvas.add(rect); canvas.add(text);
            }
        ];
        layouts[index]();
    }
    const templateContainer = document.getElementById('templates');
    for(let i=0;i<5;i++){
        const img = document.createElement('div');
        img.className='template-thumb';
        img.textContent='Template '+(i+1);
        img.onclick = () => applyTemplate(i);
        templateContainer.appendChild(img);
    }
    document.getElementById('downloadPng').onclick = () => {
        const dataURL = canvas.toDataURL({format:'png', multiplier:1920/canvas.width});
        downloadImage(dataURL,'quote.png');
    };
    document.getElementById('downloadJpg').onclick = () => {
        const dataURL = canvas.toDataURL({format:'jpeg', multiplier:1920/canvas.width, quality:0.8});
        downloadImage(dataURL,'quote.jpg');
    };
    function downloadImage(data, filename){
        const link = document.createElement('a');
        link.href = data;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>
</body>
</html>
